# 计算器项目报告文档

## 一、开发工具与平台

- **Java版本**：open-jdk17
- **项目构建工具**：Maven 3.9.9
- **开发编辑器**：VSCode
- **开发系统**：Windows 11

## 二、设计思路

### 1、界面设计

计算器界面采用现代化Windows 11风格设计，具有以下特点：

- **双模式切换**：支持标准计算器和科学计算器两种模式，用户可以通过菜单或快捷键切换
- **自适应布局**：采用Java Swing的布局管理器，确保在不同屏幕分辨率下的合理显示
- **主题自定义**：支持Windows和macOS两种风格主题，用户可以根据喜好选择
- **圆角按钮**：使用自定义的RoundedButton组件，实现圆角效果，提高视觉美感
- **视觉反馈**：按钮点击有视觉反馈，特殊功能如2nd模式、角度制有高亮显示
- **双显示区**：顶部为表达式编辑区，支持光标定位；底部为结果显示区，字体较大
- **自动字体调整**：根据显示内容长度自动调整字体大小，确保结果始终可见

界面布局遵循符合人体工程学原则的分区设计：
- 顶部：显示区域，包括表达式编辑框和结果标签
- 中部：数字键区，采用传统计算器的排列方式
- 周边：功能键区，将常用功能放在易于操作的位置

### 2、逻辑设计（课题中的难点的解决方案）

#### MVC架构设计

项目采用标准MVC（Model-View-Controller）架构，实现了关注点分离：

- **Model（模型层）**：CalculatorModel类负责所有计算逻辑和数据存储
- **View（视图层）**：CalculatorFrame类负责用户界面的显示和交互
- **Controller（控制层）**：CalculatorController类连接模型和视图，协调二者的数据交换

这种架构使各部分职责明确，便于维护和扩展。

#### 表达式解析与计算

表达式计算采用了经典的中缀表达式转后缀表达式（逆波兰式）再计算的方法：

1. 词法分析：将表达式分解为操作数和运算符
2. 转换为后缀表达式：使用操作符栈实现
3. 后缀表达式求值：使用操作数栈实现

支持的运算特性：
- 基本四则运算（加减乘除）
- 百分比计算
- 科学计数法
- 三角函数和反三角函数
- 对数函数（自然对数和常用对数）
- 阶乘、幂运算、绝对值等函数

#### 光标定位与表达式编辑功能

这是项目中的一个关键难点，解决方案包括：

1. **表达式存储改进**：
   - 使用字符串存储表达式，便于编辑和显示
   - 添加光标位置标记，跟踪用户编辑位置

2. **交互接口优化**：
   - 将原本的只读标签替换为可编辑的文本框
   - 添加文档过滤器，控制输入内容
   - 实现方向键导航和光标定位

3. **编辑与计算分离**：
   - 只在用户按下等号或回车键时才进行计算
   - 操作符输入只作为表达式的一部分，不触发计算
   - 使用文档过滤器拦截非数字输入，并转换为相应的操作符

4. **光标位置同步**：
   - 模型中记录光标位置
   - 视图和模型之间同步光标位置
   - 所有编辑操作（如插入、删除）都会更新光标位置

这一设计使得用户可以：
- 在表达式的任意位置插入数字和操作符
- 使用方向键移动光标
- 使用退格键和删除键编辑表达式
- 只有在按下等号时才进行计算，符合用户预期

## 三、实验总结

### 技术亮点

1. **MVC架构的灵活应用**：
   - 实现了视图和逻辑的有效分离
   - 便于功能扩展和界面定制

2. **计算引擎的可扩展性**：
   - 支持自定义函数和运算符
   - 表达式解析和计算模块相互独立

3. **用户体验优化**：
   - 光标定位功能大大提高了编辑效率
   - 键盘快捷键支持提升操作速度
   - 历史记录功能方便查看过去的计算

4. **错误处理机制**：
   - 完善的异常捕获和处理
   - 友好的错误信息提示
   - 自动恢复机制防止程序崩溃

### 难点与解决方法

1. **表达式解析难点**：
   - 科学计数法的识别和处理
   - 负数与减法符号的区分
   - 括号嵌套的正确解析
   
   解决方法：使用有限状态机进行词法分析，确保正确识别各类标记

2. **光标定位与表达式编辑**：
   - 光标位置与表达式同步
   - 编辑操作不应触发计算
   - 特殊字符的处理
   
   解决方法：使用文档过滤器和专用的文本处理方法，实现了精确的光标控制和文本编辑

3. **实时计算与最终计算的平衡**：
   - 用户希望看到实时反馈
   - 但不希望表达式被自动替换
   
   解决方法：分离显示计算结果和修改表达式的操作，只在用户明确要求时才替换表达式

### 学习收获

1. 深入理解了MVC架构的应用实践
2. 掌握了复杂表达式解析和计算的算法
3. 提高了Java Swing界面设计与实现能力
4. 学会了处理用户交互中的各种边界情况
5. 培养了代码重构和性能优化的能力

### 改进方向

1. **性能优化**：对大量操作和复杂表达式的计算进行优化
2. **界面美化**：添加动画效果，提升用户体验
3. **功能扩展**：支持更多科学计算功能，如微积分、矩阵运算等
4. **跨平台适配**：改进UI适配不同操作系统的外观风格
5. **云同步**：添加计算历史的云存储和多设备同步功能

本项目通过实现一个功能完善、界面友好的计算器应用，综合运用了Java编程、UI设计、算法实现等多方面的知识和技能，成功解决了表达式解析和光标定位等关键难点，为未来开发更复杂的应用程序积累了宝贵经验。 